<html lang="ru">
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://fluidsync2.herokuapp.com/socket.io/socket.io.js"></script>
    <script src="fluidsync_redis_proxy.js"></script>

    <script>
                
        function print(s)
        {
            $('body').append('<p>' + s + '</p>');       
        }
        /*
        // pure sockets style
        
        var feedbackChannel;

        $(() => {

            let socket = io('https://fluidsync2.herokuapp.com');
        
            socket.on('connect', () => {    

                feedbackChannel = 'redis-ret-' + socket.id;

                socket.on(feedbackChannel, (message) => {
                    print(message.from + ':');                
                    print('id: ' + message.payload.id);
                    print('error: ' + message.payload.error);
                    print('reply: ' + message.payload.reply);
                }); 

                socket.emit('subscribe', feedbackChannel);

                print('FluidSync2 Redis connection: ' + socket.id);
            });
            
            let sendButton = $('#sendButton');

            sendButton.click(() => 
            {
                socket.emit('publish', {channel: 'redis-command', from: socket.id, payload: 
                {feedbackChannel: feedbackChannel, id: '11', command: 'set', args: ['foo', 'bar' + Math.random()]}}); 
            });            
        });
        */
        ///*
        // proxy helper style
        $(() => {
            
            const communicator = 'https://fluidsync2.herokuapp.com';
            
            let redis = new redisProxy(communicator, (socket) => {
                print('FluidSync2 Redis connection: ' + socket.id);    
            });

            let sendButton = $('#sendButton');

            sendButton.click(() => 
            {
                redis.sendCommand('set', ['foo', 'bar' + Math.random()], (err, reply) => {
                    print('error: ' + err);
                    print('reply: ' + reply);                
                });
            });             
        });
        //*/
    </script>
<body> 
    <button id="sendButton">
        Set foo bar
    </button>   
</body>
</html>
